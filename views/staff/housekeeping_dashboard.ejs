<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
    <title><%= title %></title>
    <style>
        .section { margin-bottom: 20px; }
        .room-list li, .log-list li { margin-bottom: 5px; }
        .alert { padding: 10px; margin-bottom: 15px; border-radius: 4px; }
        .alert-success { background-color: #dff0d8; border: 1px solid #d6e9c6; color: #3c763d; }
        .alert-error { background-color: #f2dede; border: 1px solid #ebccd1; color: #a94442; }
    </style>
</head>
<body>
    <%- include('../partials/header', { user: user }) %>

    <h1><%= title %></h1>
    <p>Welcome, <%= user.username %>.</p>

    <%# Display messages based on query parameters from redirects %>
    <% if (locals.query && query.log_status === 'success') { %>
        <div class="alert alert-success">Log submitted successfully. <% if (query.room_update_status === 'attempted') { %> Room status update attempted. <% } else if (query.room_update_status === 'error') { %> Failed to update room status. <% } %></div>
    <% } else if (locals.query && query.log_status === 'error') { %>
        <div class="alert alert-error">Error submitting log. <%= query.message ? `(${query.message})` : '' %></div>
    <% } %>


    <div style="display: flex; justify-content: space-around; flex-wrap: wrap;">

        <div class="section">
            <h2>Rooms Needing Service</h2>
            <% if (rooms && rooms.length > 0) { %>
                <ul class="room-list">
                    <% rooms.forEach(room => { %>
                        <li>
                            Room <%= room.room_number %> (<%= room.status %>) -
                            <a href="/housekeeping/log/room/<%= room.id %>">Log Cleaning/Report</a>
                        </li>
                    <% }); %>
                </ul>
            <% } else { %>
                <p>No rooms currently marked as needing service.</p>
            <% } %>
        </div>

        <div class="section">
            <h2>Your Recent Logs</h2>
             <% if (recentLogs && recentLogs.length > 0) { %>
                <ul class="log-list">
                    <% recentLogs.forEach(log => { %>
                        <li>
                            <%= new Date(log.log_time).toLocaleString() %> - Room <%= log.room_number %>
                            (Linen: <%= log.linen_changed ? 'Yes' : 'No' %>, Towels: <%= log.towels_changed ? 'Yes' : 'No' %>)
                        </li>
                    <% }); %>
                </ul>
                <p><a href="/housekeeping/logs">View All Logs</a></p>
            <% } else { %>
                <p>You haven't submitted any logs recently.</p>
            <% } %>
        </div>

    </div>

    <div class="section">
        <h2>Other Actions</h2>
        <p><a href="/housekeeping/supplies">Manage Supplies Stock</a></p>
    </div>


    <%- include('../partials/footer') %>
</body>
</html>
